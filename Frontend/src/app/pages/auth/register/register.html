<div class="auth-container">
  <div class="auth-card">

    <div class="loading-overlay" *ngIf="isLoading">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <div class="card-header">
      <h2>Cadastro de {{ tipoCadastro === 'CLIENTE' ? 'Cliente' : 'Funcionário' }}</h2>
      <p>Crie sua conta para continuar</p>
    </div>

    <div class="profile-selector">
      <button mat-flat-button [color]="tipoCadastro === 'CLIENTE' ? 'primary' : ''" (click)="setTipoCadastro('CLIENTE')">
        Sou Cliente
      </button>
      <button mat-flat-button [color]="tipoCadastro === 'FUNCIONARIO' ? 'primary' : ''" (click)="setTipoCadastro('FUNCIONARIO')">
        Sou Funcionário
      </button>
    </div>

    <div class="card-body">
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
        <mat-stepper [linear]="true" #stepper>

          <mat-step label="Dados Pessoais" [stepControl]="registerForm.get('dadosPessoais')!">
            <div class="step-content" formGroupName="dadosPessoais">

              <mat-form-field appearance="outline">
                <mat-label>Nome completo</mat-label>
                <input matInput formControlName="nome" required>
                <mat-error>O nome é obrigatório.</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                <input matInput type="email" formControlName="email" required>
                <mat-error *ngIf="registerForm.get('dadosPessoais.email')?.hasError('required')">O email é obrigatório.</mat-error>
                <mat-error *ngIf="registerForm.get('dadosPessoais.email')?.hasError('email')">Formato de email inválido.</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>CPF</mat-label>
                <input matInput formControlName="cpf" placeholder="Digite 11 números" required>
                <mat-error *ngIf="registerForm.get('dadosPessoais.cpf')?.hasError('required')">CPF é obrigatório.</mat-error>
                <mat-error *ngIf="registerForm.get('dadosPessoais.cpf')?.hasError('pattern')">CPF deve conter 11 dígitos.</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Telefone</mat-label>
                <input matInput formControlName="telefone" placeholder="DDD + 8 ou 9 números" required>
                <mat-error *ngIf="registerForm.get('dadosPessoais.telefone')?.hasError('required')">Telefone é obrigatório.</mat-error>
                <mat-error *ngIf="registerForm.get('dadosPessoais.telefone')?.hasError('pattern')">Telefone deve conter 10 ou 11 dígitos.</mat-error>
              </mat-form-field>

            </div>

            <div class="step-actions">
              <button *ngIf="tipoCadastro === 'CLIENTE'" mat-raised-button color="primary" matStepperNext>Continuar</button>
              <button *ngIf="tipoCadastro === 'FUNCIONARIO'" mat-raised-button color="primary" type="submit" [disabled]="registerForm.get('dadosPessoais')?.invalid">Finalizar Cadastro</button>
            </div>
          </mat-step>

          <ng-container *ngIf="tipoCadastro === 'CLIENTE'">
            <mat-step label="Endereço" [stepControl]="registerForm.get('endereco')!">
              <div class="step-content" formGroupName="endereco">
                
                <mat-form-field appearance="outline">
                  <mat-label>CEP</mat-label>
                  <input matInput formControlName="cep" placeholder="Digite 8 números" required>
                  <mat-error *ngIf="registerForm.get('endereco.cep')?.hasError('required')">CEP é obrigatório.</mat-error>
                  <mat-error *ngIf="registerForm.get('endereco.cep')?.hasError('pattern')">CEP deve conter 8 dígitos.</mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Logradouro</mat-label>
                  <input matInput formControlName="logradouro" required>
                  <mat-error>Logradouro é obrigatório.</mat-error>
                </mat-form-field>
                
                </div>
              <div class="step-actions">
                <button mat-button matStepperPrevious>Voltar</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="registerForm.invalid">Finalizar Cadastro</button>
              </div>
            </mat-step>
          </ng-container>

        </mat-stepper>
      </form>
    </div>

    <div class="card-footer">
      <p>Já tem uma conta?</p>
      <a routerLink="/login" class="back-link">Faça login aqui</a>
    </div>
  </div>
</div>