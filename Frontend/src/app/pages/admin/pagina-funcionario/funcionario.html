<div class="funcionario-layout">
  <app-sidebar></app-sidebar>

  <div class="auth-card">
    <div class="card-header">
      <div>
        <h2>Painel do Funcionário</h2>
        <p>Solicitações aguardando orçamento</p>
      </div>

      <app-button
        title="Ver todas as solicitações"
        variant="primary"
        icon="list"
        (click)="verTodasSolicitacoes()">
      </app-button>
    </div>

    <!-- Cards de Estatísticas -->
    <div class="stats-section">
      <div class="stats-grid">
        <app-stat-card
          icon="schedule"
          [number]="estatisticas.abertas"
          label="Abertas"
          variant="warning">
        </app-stat-card>

        <app-stat-card
          icon="monetization_on"
          [number]="estatisticas.orcadas"
          label="Orçadas"
          variant="info">
        </app-stat-card>

        <app-stat-card
          icon="check_circle"
          [number]="estatisticas.aprovadas"
          label="Aprovadas"
          variant="primary">
        </app-stat-card>

        <app-stat-card
          icon="done_all"
          [number]="estatisticas.finalizadas"
          label="Finalizadas"
          variant="success">
        </app-stat-card>
      </div>
    </div>

    <!-- Seção de Solicitações Abertas - RF011 -->
    <div class="solicitacoes-section">
      <h2>Solicitações Abertas</h2>
      <p>Necessitam de atenção imediata do funcionário</p>
      
      <div class="solicitacoes-list" *ngIf="solicitacoesAbertas.length > 0">
        <div class="solicitacao-item" *ngFor="let solicitacao of solicitacoesAbertas">
          <div class="solicitacao-info">
            <div class="solicitacao-header">
              <h3>{{ solicitacao.product }}</h3>
              <span class="solicitacao-date">{{ solicitacao.order_date }}</span>
            </div>
            <div class="solicitacao-details">
              <p class="solicitacao-category">{{ solicitacao.category }}</p>
              <p class="solicitacao-description">{{ solicitacao.product | slice:0:30 }}{{ solicitacao.product.length > 30 ? '...' : '' }}</p>
            </div>
          </div>
          <div class="solicitacao-actions">
            <app-button 
              title="Efetuar Orçamento" 
              variant="primary" 
              icon="monetization_on"
              (click)="efetuarOrcamento(solicitacao)">
            </app-button>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="solicitacoesAbertas.length === 0">
        <mat-icon class="empty-icon">inbox</mat-icon>
        <h3>Não há solicitações em aberto</h3>
        <p>Bom trabalho! Todas as solicitações estão em dia.</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Detalhes da Solicitação -->
<div class="modal" *ngIf="modalAberto">
  <div class="modal-content">
    
    <h2>Detalhes da Solicitação</h2>
    <p>Visualize as informações completas da solicitação</p>

          <div *ngIf="solicitacaoSelecionada" class="solicitacao-details">
            
            <!-- Produto -->
            <div class="detail-item">
              <label>Produto:</label>
              <span>{{ solicitacaoSelecionada.product }}</span>
            </div>

            <!-- Categoria -->
            <div class="detail-item">
              <label>Categoria:</label>
              <span>{{ solicitacaoSelecionada.category }}</span>
            </div>

            <!-- Data do Pedido -->
            <div class="detail-item">
              <label>Data do Pedido:</label>
              <span>{{ solicitacaoSelecionada.order_date }}</span>
            </div>

            <!-- Status -->
            <div class="detail-item">
              <label>Status:</label>
              <span class="status-badge" [class]="getStatusClass(solicitacaoSelecionada.situation)">
                {{ getStatusText(solicitacaoSelecionada.situation) }}
              </span>
            </div>

            <!-- Preço -->
            <div class="detail-item">
              <label>Preço:</label>
              <span>R$ {{ solicitacaoSelecionada.price | number:'1.2-2' }}</span>
            </div>

            <!-- ID -->
            <div class="detail-item">
              <label>ID:</label>
              <span>{{ solicitacaoSelecionada.id }}</span>
            </div>

          </div>

    <div class="actions">
      <app-button 
        title="Fechar" 
        variant="secondary" 
        (click)="fecharModal()">
      </app-button>
      <app-button 
        [title]="getActionButtonText(solicitacaoSelecionada?.situation || SituationEnum.ABERTA)" 
        [variant]="getActionButtonVariant(solicitacaoSelecionada?.situation || SituationEnum.ABERTA)"
        [icon]="getActionButtonIcon(solicitacaoSelecionada?.situation || SituationEnum.ABERTA)"
        (click)="efetuarOrcamento(solicitacaoSelecionada!)">
      </app-button>
    </div>
  </div>
</div>