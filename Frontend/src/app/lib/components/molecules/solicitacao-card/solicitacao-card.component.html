<mat-card class="app-request-card" appearance="outlined">
  <div class="card-header">
    <div>
      <h3>{{ getShortProduct(solicitacao.descricaoEquipamento) }}</h3>
      <small>#{{ solicitacao.id }} • Cliente: {{ solicitacao.client }}</small>
    </div>
    <!--Status da solicitação-->
    <app-tag [variant]="solicitacao.situation"></app-tag>
  </div>

  <!-- Informações do card de solicitação -->
  <div class="card-body">
    <div class="info-grid">
      <div>
        <h4>Categoria</h4>
        <p>{{ solicitacao.categoriaNome }}</p>
      </div>
      <div>
        <h4>Data</h4>
        <p>{{ solicitacao.dataCriacao }}</p>
      </div>
      @if (solicitacao.funcionario) {
      <div>
        <h4>Técnico responsável</h4>
        <p>{{ solicitacao.funcionario }}</p>
      </div>
      }
      @if (solicitacao.orcamentoValor) {
      <div>
        <h4>Valor</h4>
        <div class="orcamentoValor">R$ {{ solicitacao.orcamentoValor }}</div>
      </div>
      }
    </div>

    <div class="problem-section">
      <h4>Problema</h4>
      <div class="problem-box">
        {{ solicitacao.descricaoFalha }}
      </div>
    </div>
  </div>

  <mat-card-actions align="end" *ngIf="showActions">
    <!-- Botão para modal -->
    <app-button
      title="Ver detalhes"
      variant="secondary"
      icon="visibility"
      (click)="onVerDetalhes()"
    ></app-button> 
    
    <!-- Botão de ação -->
    <app-button
      *ngIf="exibButton(solicitacao.situation)"
      [title]="getActionButtonText(solicitacao.situation)"
      [variant]="getActionButtonVariant(solicitacao.situation)"
      [icon]="getActionButtonIcon(solicitacao.situation)"
      [link]="getLink(solicitacao.situation)"
    />
  </mat-card-actions>

  <!-- Modal de Detalhes da Solicitação -->
  <div class="modal" *ngIf="modalAberto">
    <div class="modal-content">
      <h2>Detalhes da Solicitação</h2>
      <p>Visualize as informações completas da solicitação</p>

      <div class="solicitacao-details">
        <!-- Equipamento -->
        <div class="detail-item">
          <label>Equipamento:</label>
          <span>{{ solicitacao.descricaoEquipamento }}</span>
        </div>

        <!-- Categoria -->
        <div class="detail-item">
          <label>Categoria:</label>
          <span>{{ solicitacao.categoriaNome }}</span>
        </div>

        <!-- Cliente -->
        <div class="detail-item">
          <label>Cliente:</label>
          <span>{{ solicitacao.client }}</span>
        </div>

        <!-- Email do Cliente -->
        <div class="detail-item">
          <label>Email:</label>
          <span>{{ solicitacao.clientEmail }}</span>
        </div>

        <!-- Data/Hora -->
        <div class="detail-item">
          <label>Data/Hora:</label>
          <span>{{ solicitacao.dataCriacao }}</span>
        </div>

        <!-- Técnico responsável -->
        <div class="detail-item"
          *ngIf="solicitacao.funcionario">
          <label>Técnico:</label>
          <span>{{ solicitacao.funcionario }}</span>
        </div>

        <!-- Status -->
        <app-tag [variant]="solicitacao.situation" />

        <!-- Descrição do Problema -->
        <div class="detail-item full-width">
          <label>Problema Relatado:</label>
          <div class="description-box">
            {{ solicitacao.descricaoFalha }}
          </div>
        </div>

        <!-- Motivo da rejeição -->
        <div class="detail-item full-width"
          *ngIf="solicitacao.reject_reason"
        >
          <label>Motivo da rejeição:</label>
          <div class="description-box">
            {{ solicitacao.reject_reason }}
          </div>
        </div>

        <!-- Descrição da manutenção -->
        <div class="detail-item full-width"
          *ngIf="solicitacao.descricaoManutencao"
        >
          <label>Descrição da correção:</label>
          <div class="description-box">
            {{ solicitacao.descricaoManutencao }}
          </div>
        </div>

        <!-- Observações (se houver) -->
        <div
          class="detail-item full-width"
          *ngIf="solicitacao.orientacoesManutencao"
        >
          <label>Observações:</label>
          <div class="description-box">
            {{ solicitacao.orientacoesManutencao }}
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button mat-button type="button" (click)="fecharModal()">Fechar</button>

        <app-button
          *ngIf="exibButton(solicitacao.situation)"
          [title]="getActionButtonText(solicitacao.situation)"
          [variant]="getActionButtonVariant(solicitacao.situation)"
          [icon]="getActionButtonIcon(solicitacao.situation)"
          [link]="getLink(solicitacao.situation)"
        />
  
    </div>  
  </div>
  </div>
</mat-card>
